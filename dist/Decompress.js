import{BufferConsumer as e,fatal as r}from"@triforce-heroes/triforce-core";export function decompress(t){let f=new e(t,void 0,1);["Yaz0","Yaz1"].includes(f.readString(4))||r("Invalid Yaz0 header!");let o=t.length,i=17,a=f.readUnsignedInt32(),l=Buffer.allocUnsafe(a),n=0,d=t.at(16);for(;i<o&&n<a;){let e=!1;for(let r=0;r<8;r++){if(i>=o||n>=a){e=!0;break}if(128&d)l[n]=t[i],n+=1,i+=1;else{let e=t[i++],r=n-((15&e)<<8|t[i++])-1,f=e>>4;f?f+=2:(f=t[i]+18,i+=1);for(let e=0;e<f;e++)l[n]=l[r],n+=1,r+=1}d<<=1}if(!e){if(i>=o||n>=a)break;d=t[i],i+=1}}return l}