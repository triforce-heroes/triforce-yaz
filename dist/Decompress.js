import{fatal as e}from"@triforce-heroes/triforce-core/Console";export function decompress(r){["Yaz0","Yaz1"].includes(r.toString("binary",0,4))||e("Invalid Yaz0 header!");let o=r.length,t=17,f=r.readUInt32BE(4),a=Buffer.allocUnsafe(f),i=0,l=r.at(16);e:for(;t<o&&i<f;){for(let e=0;e<8;e++){if(t>=o||i>=f)break e;if(128&l)a[i]=r[t],i++,t++;else{let e=r[t++],o=i-((15&e)<<8|r[t++])-1,f=e>>4;f?f+=2:(f=r[t]+18,t++);for(let e=0;e<f;e++)a[i]=a[o],i++,o++}l<<=1}if(t>=o||i>=f)break;l=r[t],t++}return a}